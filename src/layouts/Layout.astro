---
import Analytics from "../components/Analytics.astro";
import CookieBanner from "../components/CookieBanner";
import SiteHeader from "../components/SiteHeader.astro";
import SiteFooter from "../components/SiteFooter.astro";

interface Props {
  title: string;
  description?: string;
  ogImage?: string;
  showAuthHeader?: boolean;
  isAuthenticated?: boolean;
  showBackLink?: boolean;
  backHref?: string;
  backLabel?: string;
  noIndex?: boolean;
}

const {
  title,
  description = "Catch songs from outside Spotify, and keep them. Save tracks to your Liked Songs and playlists from YouTube, SoundCloud, Deezer, Apple Music, Bandcamp, and anywhere else.",
  ogImage = "/og-image.png",
  showAuthHeader = false,
  isAuthenticated = false,
  showBackLink = false,
  backHref = "/",
  backLabel = "Back to app",
  noIndex = false,
} = Astro.props;

const canonicalUrl = new URL(
  Astro.url.pathname,
  "https://spillover.loki.m4p.uk",
).href;
const ogImageUrl = new URL(ogImage, "https://spillover.loki.m4p.uk").href;
const siteName = "Spillover";
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Primary Meta Tags -->
    <title>{title}</title>
    <meta name="title" content={title} />
    <meta name="description" content={description} />
    <meta name="author" content="Spillover" />
    <meta
      name="keywords"
      content="spotify, music, save tracks, liked songs, playlists, youtube to spotify, soundcloud to spotify, music library"
    />

    <!-- Canonical URL -->
    <link rel="canonical" href={canonicalUrl} />

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="apple-touch-icon" href="/favicon.svg" />

    <!-- Robots -->
    {noIndex && <meta name="robots" content="noindex, nofollow" />}

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalUrl} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={ogImageUrl} />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta
      property="og:image:alt"
      content="Spillover - Save tracks from anywhere to Spotify"
    />
    <meta property="og:site_name" content={siteName} />
    <meta property="og:locale" content="en_US" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content={canonicalUrl} />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={ogImageUrl} />
    <meta
      name="twitter:image:alt"
      content="Spillover - Save tracks from anywhere to Spotify"
    />

    <!-- Theme Color -->
    <meta name="theme-color" content="#22c55e" />
    <meta name="msapplication-TileColor" content="#22c55e" />

    <!-- Additional SEO -->
    <meta name="application-name" content={siteName} />
    <meta name="apple-mobile-web-app-title" content={siteName} />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="format-detection" content="telephone=no" />

    <Analytics />
  </head>
  <body class="min-h-screen text-white antialiased">
    <!-- Skip link for keyboard users -->
    <a
      href="#main-content"
      class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-[100] focus:bg-spotify-green focus:text-black focus:px-4 focus:py-2 focus:rounded-lg focus:font-medium focus:outline-none focus:ring-2 focus:ring-white"
    >
      Skip to main content
    </a>

    <div class="relative min-h-screen overflow-hidden">
      <!-- Subtle demoscene-style field -->
      <div
        class="pointer-events-none absolute -inset-[120px] opacity-[0.32] mix-blend-screen bg-[radial-gradient(circle_at_top,_rgba(56,189,248,0.32),transparent_60%),radial-gradient(circle_at_bottom,_rgba(244,63,94,0.24),transparent_60%),radial-gradient(circle_at_top_left,_rgba(129,140,248,0.3),transparent_55%)] animate-orbit-field"
      >
      </div>

      <div class="relative z-10 min-h-screen flex flex-col">
        <SiteHeader
          showAuthHeader={showAuthHeader}
          isAuthenticated={isAuthenticated}
          showBackLink={showBackLink}
          backHref={backHref}
          backLabel={backLabel}
        />
        <main id="main-content" class="flex-1">
          <slot />
        </main>
        <SiteFooter />
      </div>
    </div>
    <CookieBanner client:load />
  </body>
</html>

<style is:global>
  @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap");

  * {
    box-sizing: border-box;
  }

  html,
  body {
    width: 100%;
    max-width: 100%;
    overflow-x: hidden;
  }

  body {
    font-family:
      "Inter",
      -apple-system,
      BlinkMacSystemFont,
      "Segoe UI",
      Roboto,
      sans-serif;
    background:
      radial-gradient(circle at top, rgba(34, 197, 94, 0.18), transparent 60%),
      radial-gradient(
        circle at bottom left,
        rgba(56, 189, 248, 0.12),
        transparent 55%
      ),
      #020617;
    color: #f9fafb;
    margin: 0;
  }

  @keyframes slide-up {
    from {
      transform: translateY(100%);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  .animate-slide-up {
    animation: slide-up 0.3s ease-out;
  }

  @keyframes scale-in {
    from {
      transform: scale(0.95);
      opacity: 0;
    }
    to {
      transform: scale(1);
      opacity: 1;
    }
  }

  .animate-scale-in {
    animation: scale-in 0.2s ease-out;
  }

  @keyframes tooltip-fade-in {
    from {
      opacity: 0;
      transform: translateY(-4px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-tooltip-fade-in {
    animation: tooltip-fade-in 0.15s ease-out;
  }

  @keyframes orbit-field {
    0% {
      transform: translate3d(0, 0, 0) rotate(0deg);
    }
    50% {
      transform: translate3d(0, -12px, 0) rotate(1.5deg);
    }
    100% {
      transform: translate3d(0, 0, 0) rotate(3deg);
    }
  }

  .animate-orbit-field {
    animation: orbit-field 42s linear infinite;
    will-change: transform;
  }

  /* Screen reader only utility */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
  }

  /* Respect reduced motion preferences */
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
      scroll-behavior: auto !important;
    }

    .animate-spin,
    .animate-slide-up,
    .animate-scale-in,
    .animate-orbit-field,
    .animate-pulse {
      animation: none !important;
    }
  }
</style>
